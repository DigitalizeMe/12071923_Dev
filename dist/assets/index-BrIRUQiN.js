import{O as f,a as u,T as g,V as m,C as w,W as h,S as p,b as y,c as E,I}from"./vendor-CNceRH6c.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(e){if(e.ep)return;e.ep=!0;const i=n(e);fetch(e.href,i)}})();console.log("OBC loaded:",f);console.log("OBF loaded:",u);console.log("THREE loaded:",g);function l(o,r="info"){Toastify({text:o,duration:3e3,gravity:"top",position:"right",style:{background:r==="error"?"#ff4444":"#00C851"}}).showToast()}async function C(){try{const o=await window.electronAPI.pathJoin("cmod_restored"),n=(await window.electronAPI.readdir(o)).filter(e=>e.endsWith(".ifc")),t=document.getElementById("ifcSelector");n.forEach(e=>{const i=document.createElement("option");i.value=e,i.textContent=e,t.appendChild(i)}),console.log("IFC files loaded:",n)}catch(o){console.error("Error loading IFC files:",o),l("Failed to load IFC files","error")}}async function L(){try{const o=document.getElementById("viewer-container");if(!o)throw new Error("Viewer container not found");console.log("Viewer container found:",o);const r=new w;console.log("Components initialized:",r);const t=r.get(h).create();console.log("World created:",t),t.scene=new p(r),t.renderer=new y(r,o),t.camera=new E(r),console.log("Scene, renderer, camera set:",t.scene,t.renderer,t.camera),console.log("Renderer three.domElement:",t.renderer.three.domElement),r.init(),t.camera.controls.setLookAt(12,6,8,0,0,-10),t.scene.setup();const e=r.get(I);return console.log("IfcLoader:",e),await e.setup(),e.settings.wasm={path:"./static/",absolute:!1},console.log("IfcLoader configured:",e.settings.wasm),console.log("Viewer initialized:",r),{components:r,world:t,ifcLoader:e}}catch(o){throw console.error("Error initializing viewer:",o),l("Failed to initialize viewer: "+o.message,"error"),o}}async function v(o){if(!o){l("Please select an IFC file","error");return}try{l(`Loading ${o}...`,"info");const{components:r,world:n,ifcLoader:t}=await L(),e=await window.electronAPI.pathJoin("cmod_restored",o),i=await window.electronAPI.readFile(e),c=await t.load(i);n.scene.three.add(c),l(`${o} loaded successfully`,"info");const s=r.get(m);console.log("Highlighter loaded:",s),await s.setup({world:n,selection:{default:{}}}),console.log("Highlighter configured with default selection"),n.renderer&&n.renderer.three&&n.renderer.three.domElement?(console.log("Adding click event listener to:",n.renderer.three.domElement),n.renderer.three.domElement.addEventListener("click",async()=>{const a=await s.highlight("default");if(a){const{fragment:F,id:d}=a;l(`Selected component: ${d}`,"info")}})):(console.error("Renderer three.domElement not available:",n.renderer),l("Click interaction not available: Renderer not initialized","error"))}catch(r){console.error("Error loading IFC:",r),l(`Failed to load ${o}: ${r.message}`,"error")}}document.addEventListener("DOMContentLoaded",()=>{C();const o=document.getElementById("ifcSelector");o?(o.addEventListener("change",r=>{const n=r.target.value;console.log("Selected IFC file:",n),v(n)}),console.log("Dropdown event listener attached")):(console.error("Dropdown element not found"),l("Dropdown element not found","error"))});
